<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content">
    <title>CrisisConnect | Disaster Command Center</title>
    
    <!-- Fonts (Optional: System fonts used as fallback) -->
    <!-- <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"> -->
    
    <!-- Dependencies (Local Offline Support) -->
    <script src="js/sockjs.min.js"></script>
    <script src="js/stomp.min.js"></script>
    
    <!-- App Styles & Offline Icons -->
    <script src="js/qrcode.min.js"></script>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/offline-icons.css">
    <link rel="manifest" href="manifest.json">

    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('SW registered'))
                    .catch(err => console.log('SW registration failed: ', err));
            });
        }
    </script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo-area">
                <i class="ph-fill ph-siren" style="font-size: 2rem; color: var(--danger-color);"></i>
                <span class="logo-text">CrisisConnect</span>
            </div>
            
            <div class="header-stats">
                <div class="stat-item">
                    <div class="stat-value" id="statUsers">0</div>
                    <div class="stat-label"><i class="ph-bold ph-users-three"></i> Active</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="statMessages">0</div>
                    <div class="stat-label"><i class="ph-bold ph-chat-centered-text"></i> Messages</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="statCritical" style="color: var(--danger-color)">0</div>
                    <div class="stat-label"><i class="ph-bold ph-warning-circle"></i> Critical</div>
                </div>
            </div>

            <div class="header-controls" style="display: flex; gap: 1rem; align-items: center;">
                <button id="btnShowQR" class="btn btn-sm" style="background: var(--accent-color); color: white; display: none;"><i class="ph-bold ph-qr-code"></i> Connect Devices</button>
                <button id="btnConnect" class="btn btn-sm" style="display: none;"><i class="ph-bold ph-plug"></i> Connect</button>
                <button id="btnDisconnect" class="btn btn-sm btn-danger" style="display: none;"><i class="ph-bold ph-plugs"></i> Disconnect</button>
                <div class="connection-badge disconnected" id="connectionStatus">
                    <span class="indicator"></span> Offline
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="app-sidebar">
            <div class="my-status-card card">
                <div class="section-title"><i class="ph-bold ph-user-focus"></i> My Status</div>
                <div class="status-selector">
                    <select id="myStatus">
                        <option value="SAFE">Safe & Secure</option>
                        <option value="NEED_HELP">Need Assistance</option>
                        <option value="INJURED">Medical Emergency</option>
                        <option value="CRITICAL">Critical Danger</option>
                    </select>
                </div>
            </div>

            <div class="status-feed">
                <div class="section-title"><i class="ph-bold ph-broadcast"></i> Network Feed</div>
                <div class="status-list" id="statusList">
                    <!-- Status items injected here -->
                </div>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="chat-area">
            <div class="messages-container" id="messagesContainer">
                <div class="empty-state" style="margin: auto; text-align: center; color: var(--text-secondary); opacity: 0.5;">
                    <i class="ph-duotone ph-chat-circle-dots" style="font-size: 4rem; margin-bottom: 1rem;"></i>
                    <p>No messages yet. Start the conversation.</p>
                </div>
                <!-- Messages injected here -->
            </div>

                <div class="input-zone">
                    <div class="input-row">
                        <div class="input-wrapper" style="flex: 0 0 auto; min-width: 120px;">
                             <i class="ph-bold ph-user input-icon"></i>
                             <input type="text" id="userNameInput" class="input-field has-icon" placeholder="ID" autocomplete="off">
                        </div>
                        <div class="input-wrapper" style="flex:1;">
                            <i class="ph-bold ph-paper-plane-right input-icon"></i>
                            <input type="text" id="messageInput" class="input-field has-icon" placeholder="Type a message..." autocomplete="off">
                        </div>
                        <button class="btn btn-icon" id="btnShareLoc" title="Share Location"><i class="ph-bold ph-map-pin"></i></button>
                        <button class="btn btn-icon" id="btnSend"><i class="ph-bold ph-arrow-right"></i></button>
                        <button class="btn btn-danger btn-icon" id="btnSOS" title="Send SOS"><i class="ph-bold ph-warning"></i></button>
                    </div>
                </div>
        </main>
    </div>

    <!-- Location Input Modal -->
    <div id="locationModal" class="modal" style="display: none;">
        <div class="modal-content card">
            <h3 class="section-title" style="font-size: 1rem; margin-bottom: 1rem;">Share Location Details</h3>
            <div class="input-wrapper" style="margin-bottom: 1rem;">
                <i class="ph-bold ph-map-pin input-icon"></i>
                <input type="text" id="manualLocationInput" class="input-field has-icon" placeholder="Describe your location (e.g. 'Red House, Roof')..." autocomplete="off">
            </div>
            <div class="modal-actions" style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button id="btnCancelLoc" class="btn btn-sm" style="background: transparent; border: 1px solid var(--glass-border);">Cancel</button>
                <button id="btnConfirmLoc" class="btn btn-sm">Share Location</button>
            </div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="qrModal" class="modal" style="display: none;">
        <div class="modal-content card" style="text-align: center; max-width: 350px;">
            <h3 class="section-title" style="font-size: 1rem; margin-bottom: 1.5rem;">Scan to Connect</h3>
            <div id="qrcode" style="display: flex; justify-content: center; margin-bottom: 1.5rem; padding: 10px; background: white; border-radius: 8px;"></div>
            <div id="serverUrl" style="font-family: monospace; font-size: 1.1rem; margin-bottom: 1.5rem; color: var(--accent-color);"></div>
            <p style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 1.5rem;">
                Connect to the <strong>Host Wi-Fi</strong> first,<br>then scan this code or type the URL.
            </p>
            <button id="btnCloseQR" class="btn btn-sm" style="width: 100%;">Close</button>
        </div>
    </div>

    <!-- App Logic -->
    <script src="js/app.js"></script>
</body>
</html>